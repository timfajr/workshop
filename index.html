<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SheetStore ðŸ›’</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        [x-cloak] { display: none !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800" 
      x-data="shop()" 
      x-init="fetchProducts()">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">SheetStore ðŸ›’</h1>
            
            <button @click="cartOpen = true" class="relative p-2 text-gray-600 hover:text-indigo-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full" x-show="cart.length > 0" x-text="cart.length"></span>
            </button>
        </div>
    </header>

    <main x-show="!cartOpen && !checkoutOpen" class="container mx-auto px-4 py-8">
        
        <div x-show="isLoading" class="text-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-gray-500">Loading products from local CSV...</p>
        </div>

        <div x-show="!isLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" x-cloak>
            <template x-for="product in paginatedProducts" :key="product.id">
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 flex flex-col h-full">
                    
                    <div class="relative group">
                        <img :src="product.image" alt="Product Image" class="w-full h-64 object-contain p-4 group-hover:scale-105 transition-transform duration-300">
                        <div x-show="product.discount > 0" 
                             class="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded shadow-sm">
                            <span x-text="'-' + product.discount + '%'"></span>
                        </div>
                    </div>

                    <div class="p-6 flex flex-col flex-1">
                        <h2 class="text-md font-bold mb-2 line-clamp-1" x-text="product.name"></h2>
                        <p class="text-gray-600 text-xs mb-4 line-clamp-3 flex-1" x-text="product.description"></p>
                        
                        <div class="flex justify-between items-end mt-auto">
                            <div class="flex flex-col">
                                <div class="flex flex-row gap-2 items-center" x-show="product.discount > 0">
                                    <span class="text-xs text-gray-400 line-through" x-text="'Rp.' + product.original_price"></span>
                                    <span class="text-[10px] text-red-600 bg-red-100 px-1.5 py-0.5 rounded-full font-bold">
                                        Hemat <span x-text="product.discount + '%'"></span>
                                    </span>
                                </div>
                                <span class="text-lg font-bold text-indigo-600" x-text="'Rp.' + product.price"></span>
                            </div>

                            <button @click="addToCart(product)" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition shadow-sm font-medium text-sm">
                                + Keranjang
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <div x-show="!isLoading && products.length > itemsPerPage" class="mt-12 flex justify-center items-center space-x-4" x-cloak>
            <button 
                @click="prevPage()" 
                :disabled="currentPage === 1"
                :class="currentPage === 1 ? 'opacity-50 cursor-not-allowed bg-gray-200 text-gray-400' : 'bg-white hover:bg-gray-100 text-gray-700 border-gray-300'"
                class="px-4 py-2 border rounded-md shadow-sm text-sm font-medium transition-colors">
                &larr; Previous
            </button>

            <span class="text-sm text-gray-600 font-medium">
                Page <span x-text="currentPage"></span> of <span x-text="totalPages"></span>
            </span>

            <button 
                @click="nextPage()" 
                :disabled="currentPage === totalPages"
                :class="currentPage === totalPages ? 'opacity-50 cursor-not-allowed bg-gray-200 text-gray-400' : 'bg-white hover:bg-gray-100 text-gray-700 border-gray-300'"
                class="px-4 py-2 border rounded-md shadow-sm text-sm font-medium transition-colors">
                Next &rarr;
            </button>
        </div>

    </main>

    <div x-show="cartOpen" class="relative z-50" aria-labelledby="slide-over-title" role="dialog" aria-modal="true" x-cloak>
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="cartOpen = false"></div>
        <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
                <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full md:pl-10">
                    <div class="pointer-events-auto w-screen max-w-screen md:max-w-md">
                        <div class="flex h-full flex-col overflow-y-scroll bg-white shadow-xl">
                            <div class="flex-1 overflow-y-auto py-6 px-4 sm:px-6">
                                <div class="flex items-start justify-between">
                                    <h2 class="text-lg font-medium text-gray-900">Keranjang Belanja</h2>
                                    <button @click="cartOpen = false" class="-m-2 p-2 text-gray-400 hover:text-gray-500">
                                        <span class="sr-only">Close panel</span>
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                    </button>
                                </div>

                                <div class="mt-8">
                                    <div class="flow-root">
                                        <ul role="list" class="-my-6 divide-y divide-gray-200">
                                            <template x-for="(item, index) in cart" :key="index">
                                                <li class="flex py-6">
                                                    <div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200">
                                                        <img :src="item.image" class="h-full w-full object-cover object-center">
                                                    </div>
                                                    <div class="ml-4 flex flex-1 flex-col">
                                                        <div>
                                                            <div class="flex justify-between text-base font-medium text-gray-900">
                                                                <h3 class="line-clamp-2 text-sm" x-text="item.name"></h3>
                                                                <p class="ml-4 text-sm font-bold" x-text="'Rp.' + item.price"></p>
                                                            </div>
                                                        </div>
                                                        <div class="flex flex-1 items-end justify-between text-sm">
                                                            <p class="text-gray-500">Qty 1</p>
                                                            <button @click="removeFromCart(index)" type="button" class="font-medium text-red-600 hover:text-red-500">Hapus</button>
                                                        </div>
                                                    </div>
                                                </li>
                                            </template>
                                            <li x-show="cart.length === 0" class="py-10 text-center text-gray-500 flex flex-col items-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                                </svg>
                                                Keranjang masih kosong
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 py-6 px-4 sm:px-6">
                                <div class="flex justify-between text-base font-medium text-gray-900">
                                    <p>Subtotal</p>
                                    <p x-text="'Rp.' + cartTotal"></p>
                                </div>
                                <div class="mt-6">
                                    <button 
                                        @click="cartOpen = false; checkoutOpen = true; selectedPayment = bankAccounts[0]"
                                        :disabled="cart.length === 0"
                                        :class="cart.length === 0 ? 'bg-gray-300 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700'"
                                        class="w-full flex items-center justify-center rounded-md border border-transparent px-6 py-3 text-base font-medium text-white shadow-sm transition">
                                        Lanjut ke Pembayaran
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div x-show="checkoutOpen && !cartOpen" class="relative z-50" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-cloak>
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="checkoutOpen = false"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                    
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="w-full">
                            <h3 class="text-xl font-bold leading-6 text-gray-900 text-center mb-6" id="modal-title">Checkout</h3>
                            
                            <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    Data Pemesan
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1">Nama Lengkap</label>
                                        <input type="text" x-model="customer.name" class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="Contoh: Budi Santoso">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1">Alamat Lengkap</label>
                                        <textarea x-model="customer.address" rows="2" class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="Jalan, RT/RW, Kecamatan, Kota..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <h4 class="text-sm font-bold text-gray-800 mb-2">Metode Pembayaran</h4>
                            <div class="grid grid-cols-4 gap-2 mb-4">
                                <template x-for="bank in bankAccounts" :key="bank.bank">
                                    <button @click="selectedPayment = bank; isQris = false"
                                            :class="(!isQris && selectedPayment.bank === bank.bank) ? 'border-indigo-600 bg-indigo-50 text-indigo-700 ring-1 ring-indigo-600' : 'border-gray-200 hover:border-indigo-300 hover:bg-gray-50'"
                                            class="flex flex-col items-center justify-center p-2 border rounded-lg transition-all h-20 bg-white">
                                        <img x-show="bank.logo" :src="bank.logo" :alt="bank.bank" class="h-6 w-14 object-contain mb-1"/>
                                        <span x-show="!bank.logo" class="font-bold text-sm" x-text="bank.bank"></span>
                                        <span class="text-[10px] text-gray-500">Transfer</span>
                                    </button>
                                </template>
                                
                                <button @click="isQris = true; selectedPayment = null"
                                        :class="isQris ? 'border-indigo-600 bg-indigo-50 text-indigo-700 ring-1 ring-indigo-600' : 'border-gray-200 hover:border-indigo-300 hover:bg-gray-50'"
                                        class="flex flex-col items-center justify-center p-2 border rounded-lg transition-all h-20 bg-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-1 text-gray-700" :class="isQris ? 'text-indigo-600' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                    </svg>
                                    <span class="text-[10px] text-gray-500">QRIS</span>
                                </button>
                            </div>

                            <div class="mb-4 p-4 border border-blue-200 bg-blue-50 rounded-lg shadow-sm flex flex-col justify-center">
                                <div class="text-center mb-3">
                                    <p class="text-xs text-gray-500 uppercase tracking-wide">Total Tagihan</p>
                                    <p class="text-2xl font-bold text-indigo-700" x-text="'Rp.' + cartTotal"></p>
                                </div>
                                <hr class="border-blue-200 mb-3">

                                <template x-if="!isQris && selectedPayment">
                                    <div class="text-center">
                                        <p class="text-xs text-gray-600 mb-1">Silakan transfer ke <span class="font-bold" x-text="selectedPayment.bank"></span></p>
                                        <div class="flex items-center justify-between bg-white px-3 py-2 rounded border border-blue-100 mb-1">
                                            <span class="font-mono font-bold text-gray-800 select-all" x-text="selectedPayment.number"></span>
                                            <button @click="copyToClipboard(selectedPayment.number)" class="text-xs text-indigo-600 hover:text-indigo-800 font-bold uppercase ml-2">Salin</button>
                                        </div>
                                        <p class="text-xs text-gray-500" x-text="'a.n. ' + selectedPayment.name"></p>
                                    </div>
                                </template>

                                <template x-if="isQris">
                                    <div class="text-center">
                                        <p class="text-xs text-gray-600 mb-2">Scan QR untuk membayar</p>
                                        <div class="flex justify-center bg-white p-2 rounded inline-block mx-auto">
                                            <img :src="qrisUrl" alt="QRIS Code" class="h-32 w-32 object-contain">
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <p class="text-[10px] text-gray-400 text-center leading-tight">
                                Klik tombol konfirmasi di bawah untuk mengirim detail pesanan ke WhatsApp Admin.
                            </p>
                        </div>
                    </div>

                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                        <a :href="customer.name && customer.address ? whatsappLink : '#'" 
                           :target="customer.name && customer.address ? '_blank' : ''"
                           :class="{'opacity-50 cursor-not-allowed bg-gray-400': !customer.name || !customer.address, 'bg-green-600 hover:bg-green-700': customer.name && customer.address}"
                           class="inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none sm:ml-3 sm:w-auto sm:text-sm transition-all items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            Konfirmasi via WhatsApp
                        </a>
                        <button @click="checkoutOpen = false" type="button" class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Batal
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        function shop() {
            return {
                isLoading: true,
                cartOpen: false,
                checkoutOpen: false,
                products: [],
                cart: [],

                // PAGINATION STATE
                currentPage: 1,
                itemsPerPage: 6,

                // PAYMENT STATE
                selectedPayment: null, 
                isQris: false,
                
                // CUSTOMER DATA
                customer: {
                    name: '',
                    address: ''
                },

                // CONFIG: BANK ACCOUNTS
                bankAccounts: [
                    { bank: "BCA", number: "1234567890", name: "Toko Saya" , logo: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg" },
                    { bank: "BRI", number: "0987654321", name: "Toko Saya", logo: "https://upload.wikimedia.org/wikipedia/commons/6/68/BANK_BRI_logo.svg" },
                    { bank: "MANDIRI", number: "1122334455", name: "Toko Saya" , logo: "https://upload.wikimedia.org/wikipedia/commons/a/ad/Bank_Mandiri_logo_2016.svg" }
                ],
                qrisUrl: "https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg", 

                // CONFIG: DATA SOURCE (LOCAL FILE)
                url: 'product.csv', 

                async fetchProducts() {
                    try {
                        const response = await fetch(this.url);
                        
                        if (!response.ok) {
                            throw new Error("Failed to load product.csv. Are you running a local server?");
                        }

                        const csvText = await response.text();
                        const data = this.csvToJson(csvText);
                        
                        this.products = data.map(item => {
                            const original = parseFloat(item.price) || 0;
                            const discountPercent = parseFloat(item.discount) || 0;
                            const final = discountPercent > 0 ? (original * (1 - discountPercent/100)).toFixed(2) : original;

                            return {
                                id: item.id,
                                name: item.name,
                                original_price: original,
                                discount: discountPercent,
                                price: parseFloat(final),
                                description: item.description,
                                image: item.image
                            }
                        });
                        
                        this.selectedPayment = this.bankAccounts[0];
                    } catch (error) {
                        console.error('Error fetching products:', error);
                        alert("Error: Could not load products. Please ensure you are opening this file via a Local Server (not double clicking).");
                    } finally {
                        this.isLoading = false;
                    }
                },

                // PAGINATION LOGIC
                get totalPages() {
                    return Math.ceil(this.products.length / this.itemsPerPage);
                },

                get paginatedProducts() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    return this.products.slice(start, end);
                },

                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        // Scroll to top of grid
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                // CSV Parser Helper
                csvToJson(csv) {
                    const lines = csv.trim().split("\n");
                    const headers = lines[0].split(",").map(h => h.trim().replace(/^"|"$/g, ''));
                    
                    return lines.slice(1).map(line => {
                        const rowValues = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        let obj = {};
                        headers.forEach((header, i) => {
                            let val = rowValues[i] ? rowValues[i].trim() : '';
                            if (val.startsWith('"') && val.endsWith('"')) {
                                val = val.substring(1, val.length - 1);
                            }
                            obj[header] = val;
                        });
                        return obj;
                    });
                },

                addToCart(product) {
                    this.cart.push(product);
                },

                removeFromCart(index) {
                    this.cart.splice(index, 1);
                },

                copyToClipboard(text) {
                    navigator.clipboard.writeText(text);
                    const originalText = event.target.innerText;
                    event.target.innerText = "Disalin!";
                    setTimeout(() => { event.target.innerText = originalText; }, 1500);
                },

                get cartTotal() {
                    return this.cart.reduce((total, item) => total + item.price, 0).toFixed(2);
                },

                get whatsappLink() {
                    const phoneNumber = "62882000710173"; 
                    
                    let paymentMethodName = "Unknown";
                    if (this.isQris) {
                        paymentMethodName = "QRIS";
                    } else if (this.selectedPayment) {
                        paymentMethodName = this.selectedPayment.bank;
                    }

                    let message = `*Halo Admin! Saya ingin konfirmasi pesanan baru.*%0a%0a`;
                    
                    message += `ðŸ‘¤ *DATA PEMESAN*%0a`;
                    message += `Nama: ${this.customer.name}%0a`;
                    message += `Alamat: ${this.customer.address}%0a%0a`;

                    message += `ðŸ’³ *PEMBAYARAN*%0a`;
                    message += `Metode: ${paymentMethodName}%0a`;
                    message += `Total Transfer: *Rp.${this.cartTotal}*%0a%0a`;

                    message += `ðŸ›’ *DETAIL ORDER*%0a`;
                    this.cart.forEach(item => {
                        message += `- ${item.name} @ Rp.${item.price}%0a`;
                    });
                    
                    message += `%0aMohon segera diproses ya, Terima kasih!`;

                    return `https://wa.me/${phoneNumber}?text=${message}`;
                }
            }
        }
    </script>
</body>
</html>